#!/bin/bash

PREFIX='  Updates: '
CACHE_FILE="/tmp/pacman_updates_$$"
CACHE_DURATION=300

get_updates() {
    local updates_arch=0 updates_aur=0 total=0
    
    if command -v checkupdates >/dev/null 2>&1; then
        updates_arch=$(checkupdates 2>/dev/null | wc -l)
    fi
    
    if command -v yay >/dev/null 2>&1; then
        updates_aur=$(yay -Qum 2>/dev/null | wc -l)
    elif command -v paru >/dev/null 2>&1; then
        updates_aur=$(paru -Qum 2>/dev/null | wc -l)
    elif command -v trizen >/dev/null 2>&1; then
        updates_aur=$(trizen -Qum 2>/dev/null | wc -l)
    fi
    
    total=$((updates_arch + updates_aur))
    echo "$total" > "$CACHE_FILE"
    echo "$PREFIX$total"
}

if [[ -f "$CACHE_FILE" && $(($(date +%s) - $(stat -c %Y "$CACHE_FILE"))) -lt $CACHE_DURATION ]]; then
    echo "$PREFIX$(cat "$CACHE_FILE")"
else
    get_updates
fi
