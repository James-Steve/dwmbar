#!/bin/bash

# Prints out the current up network traffic in MB

PREFIX='ï‚ª '

get_up_traffic() {
    local statdir=${NET_STAT_DIR:-/sys/class/net}
    local transmit1=0 transmit2=0

    for iface_path in "$statdir"/*; do
        iface=$(basename "$iface_path")
        [[ "$iface" == "lo" ]] && continue
        tx_file="$iface_path/statistics/tx_bytes"
        [[ -f "$tx_file" ]] || continue
        transmit1=$((transmit1 + $(cat "$tx_file" 2>/dev/null)))
    done

    sleep 1

    for iface_path in "$statdir"/*; do
        iface=$(basename "$iface_path")
        [[ "$iface" == "lo" ]] && continue
        tx_file="$iface_path/statistics/tx_bytes"
        [[ -f "$tx_file" ]] || continue
        transmit2=$((transmit2 + $(cat "$tx_file" 2>/dev/null)))
    done

    local kbps=$(((transmit2 - transmit1) / 1000))
    echo "$PREFIX${kbps}KB/s"
}

get_up_traffic

